# InferaDB Control Configuration - Integration Tests
# This config is optimized for Docker container E2E testing
#
# This file uses the unified configuration format. Both engine and control
# can share the same config file by reading their respective sections.

control:
  threads: 2  # Reduced for test environment
  logging: "debug"  # Verbose logging for tests

  frontend:
    url: "http://localhost:9090"

  listen:
    # Client-facing HTTP/REST API server
    http: "0.0.0.0:9090"

    # Client-facing gRPC API server
    grpc: "0.0.0.0:9091"

    # Service mesh / inter-service communication
    mesh: "0.0.0.0:9092"

  storage:
    backend: "memory"  # In-memory for fast tests

  authentication:
    session_ttl_web: 3600  # 1 hour for tests
    session_ttl_cli: 7200  # 2 hours for tests
    session_ttl_sdk: 7200  # 2 hours for tests
    password_min_length: 8  # Relaxed for tests
    max_sessions_per_user: 5
    key_encryption_secret: "test-integration-secret-key-32bytes-long!"
    webauthn:
      rp_id: "localhost"
      rp_name: "InferaDB Test"
      origin: "http://localhost:9090"

  email:
    smtp_host: "localhost"
    smtp_port: 1025
    from_email: "test@inferadb.local"
    from_name: "InferaDB Test"

  limits:
    login_attempts_per_ip_per_hour: 1000  # Relaxed for tests
    registrations_per_ip_per_day: 100
    email_verification_tokens_per_hour: 100
    password_reset_tokens_per_hour: 100

  # Engine configuration for Kubernetes
  # Discovery mode discovers all engine pod IPs
  engine:
    service_url: "http://inferadb-engine.inferadb"
    grpc_port: 8081
    internal_port: 8082

  webhook:
    timeout_ms: 5000
    retry_attempts: 0

  # Kubernetes discovery for pod-level cache invalidation
  discovery:
    mode:
      type: kubernetes
    cache_ttl: 30
