# InferaDB Control Configuration - Production Template
#
# This is a template for production deployment. Replace all placeholder values
# (marked with <...>) with your actual production values.
#
# SECURITY: Do not commit this file with real credentials to version control.
# Use environment variables or a secrets management system in production.
#
# This file uses the unified configuration format. Both engine and control
# can share the same config file by reading their respective sections.

control:
  # Worker threads (recommended: number of CPU cores)
  threads: 8
  logging: "info"

  listen:
    # Client-facing HTTP/REST API server (web, CLI, SDK)
    http: "0.0.0.0:9090"

    # Client-facing gRPC API server
    grpc: "0.0.0.0:9091"

    # Service mesh / inter-service communication
    mesh: "0.0.0.0:9092"

  # Storage backend configuration
  storage:
    # Use FoundationDB for production
    backend: "foundationdb"

    # FoundationDB cluster file path
    # This file contains the connection string for your FDB cluster
    fdb_cluster_file: "/etc/foundationdb/fdb.cluster"

  # Authentication and security
  authentication:
    # Session TTLs (in seconds)
    session_ttl_web: 2592000  # 30 days
    session_ttl_cli: 7776000  # 90 days
    session_ttl_sdk: 7776000  # 90 days

    # Password requirements
    password_min_length: 12

    # Maximum concurrent sessions per user
    max_sessions_per_user: 10

    # Key encryption secret (REQUIRED: 32+ bytes for AES-256)
    # SECURITY: Use environment variable in production!
    # Example: ${KEY_ENCRYPTION_SECRET}
    key_encryption_secret: "<REPLACE-WITH-32+-BYTE-SECRET>"

    # WebAuthn configuration (for passkey authentication)
    webauthn:
      # Relying party ID (your domain)
      rp_id: "example.com"

      # Relying party name (displayed to users)
      rp_name: "InferaDB"

      # Origin URL (must match browser origin)
      origin: "https://example.com"

  # Email configuration (SMTP)
  email:
    # SMTP server settings
    smtp_host: "<SMTP-HOST>"
    smtp_port: 587

    # SMTP authentication (optional, uncomment if needed)
    # smtp_username: "<SMTP-USERNAME>"
    # smtp_password: "<SMTP-PASSWORD>"

    # From address
    from_email: "noreply@example.com"
    from_name: "InferaDB"

  # Rate limits configuration
  limits:
    # Login attempts per IP per hour
    login_attempts_per_ip_per_hour: 100

    # Registration attempts per IP per day
    registrations_per_ip_per_day: 5

    # Email verification tokens per email per hour
    email_verification_tokens_per_hour: 5

    # Password reset tokens per user per hour
    password_reset_tokens_per_hour: 3

  # Engine configuration
  # All engine instances are discovered from this base URL + ports
  # In production with Kubernetes/Tailscale discovery, set discovery.mode appropriately
  engine:
    # Base service URL (without port)
    # For Kubernetes: use the k8s service name (e.g., "http://inferadb-engine.inferadb")
    # For direct connection: use the host (e.g., "http://localhost")
    service_url: "http://inferadb-engine.inferadb"

    # gRPC port for engine communication
    grpc_port: 8081

    # Internal/Private HTTP port for webhooks and JWKS
    internal_port: 8082
